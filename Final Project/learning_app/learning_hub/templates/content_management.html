{% extends 'base.html' %}

{% block title %} Sign Up {% endblock %}


{% block body %}


<!-----------------------start Tabs --------------------->
<ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item">
    <a class="nav-link active" href="#questions" data-toggle="tab" id ="questions-tab"   role="tab">Question Manager</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="#exam"  data-toggle="tab" id ="exam-tab" role="tab">Exam Manager</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="#tab-notion"  data-toggle="tab" id ="notion-tab" role="tab">Notions Manager</a>
  </li>

</ul>
<!-----------------------End Tabs --------------------->



<!-----------------------Start Tab Content --------------------->
<div class="tab-content " id="myTabContent">

  <div class="tab-pane fade show active" id="questions" role="tabpanel" aria-labelledby="questions-tab">

      <!------Questions ------>
      <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#create-question" aria-expanded="false" aria-controls="collapseExample">
          Create New Question
      </button><br><br>
      <div class="collapse" id="create-question">
        <h4> Create new Quetsion</h4>
            <form method="POST" action="{{url_for('hub.create_quest')}}">
                  <table>
                      <tbody>
                      {% for key in quest_form %}
                          {% if key.label.text != 'CSRF Token' %}
                          <tr>
                              <td>{{key.label}}</td>
                              <td>{{key(class = "form-control")}}</td>
                          </tr>
                          {% endif %}
                      {% endfor %}
                      </tbody>
                  </table>

            </form>
      </div>
      <!-----------------delete Question----------------->
      <button class="btn btn-primary" type="button" id="delete_btn" data-toggle="collapse" data-target="#delete-question" aria-expanded="false" aria-controls="collapseExample">
          Delete Question
      </button><br><br>
        <div class="collapse" id="delete-question">
          <div id="delete-q1">
              <h4> Delete Question</h4>
              <form method="post" action="{{url_for('hub.find_questions_to_delete')}}" id="question-delete">
                  <br>
                  <label>Search by Email</label>
                  <input type="text" class="form-control" id="q_delete" placeholder="Enter title" name = 'string_delete'>
                  <button class="btn btn-info btn-small" id = "q_delete_btn">Search</button>
              </form>
            </div>

        <div class="collapse d-none" id="delete-selection">
                <h4> Select Questions to delete</h4>

          <form  id ="form_delete_items"  method="POST" action="{{url_for('hub.delete_questions')}}" >
            <table class="table">
              <thead>
                <tr>
                  <th scope="col"></th>
                  <th scope="col">ID</th>
                  <th scope="col">Title</th>
                  <th scope="col">Question Body</th>
                  <th scope="col">Type</th>
                  <th scope="col">Notion</th>
                  <th scope="col">Sub Notion</th>
                  <th scope="col">Complexity level</th>
                </tr>
              </thead>
              <tbody id = "form_delete_body">

              </tbody>
              </table>
             <button type="submit" class="btn btn-primary">Delete</button>
          </form>
        </div>
        </div>

  </div>
  <!-------------------------Exams------------------------------->
  <div class="tab-pane fade" id="exam" role="tabpanel" aria-labelledby="exam-tab">

        <!------------crate exam---------------->
        <button class="btn btn-primary" type="button" id="e_create_show" data-toggle="collapse" data-target="#create-exam" aria-expanded="false" aria-controls="collapseExample">
            Create New Exam
        </button><br><br>
        <div class="collapse" id="create-exam">
          <h4> Create new Exam</h4>
              <form method="POST" action="{{url_for('hub.create_exam')}}">
                <table>
                    <tbody  id = "form_create_exam_body">
                    {% for key in exam_form %}
                        {% if key.label.text != 'CSRF Token' %}
                        <tr>
                            <td>{{key.label}}</td>
                            <td>{{key(class = "form-control")}}</td>
                        </tr>
                        {% endif %}
                    {% endfor %}
                    </tbody>
                </table>
              </form>
        </div>

        <!------------Delete---------------->
        <button class="btn btn-primary collapsed" type="button" id="e_delete_show" data-toggle="collapse" data-target="#delete-exam" aria-expanded="false" aria-controls="collapseExample">
            Delete an Exam
        </button><br><br>
        <div class="collapse" id="delete-exam">
          <h4> Delete Exam</h4>
              <form method="POST" action="{{url_for('hub.delete_exam_show')}}">
                <br>
                <label>Search by title</label>
                <input type="text" class="form-control" id="e_delete" placeholder="Enter title" name = 'string_delete'>
                <button class="btn btn-info btn-small" id = "e_delete_btn">Search</button>
              </form>
        </div>
        <!-----------------delete exam--------------------->
        <div class = "collapse" id="delete_exam_selection">
          <h4> Select exams to delete</h4>

              <form  id ="form_delete_exams"  method="POST" action="{{url_for('hub.delete_exam')}}" >
                <table class="table">
                    <thead>
                      <tr>
                        <th scope="col"></th>
                        <th scope="col">ID</th>
                        <th scope="col">Title</th>
                        <th scope="col">Type</th>
                        <th scope="col">Notion</th>
                        <th scope="col">Sub Notion</th>
                        <th scope="col">Complexity level</th>
                      </tr>
                    </thead>
                    <tbody id = "form_delete_exam_body">

                    </tbody>
                  </table>
                 <button type="submit" class="btn btn-primary">Delete</button>
              </form>
          </div>
    </div>


 <!-- -------------------Notions manager--------------- -->


    <div class="tab-pane fade" id="tab-notion" role="tabpanel" aria-labelledby="notion-tab">
          <!-- -------------show notions ------------ -->

      <div class="" id="notions-show">
        <h4> Available Notions</h4>

        <form method="POST" action="{{url_for('hub.delete_notions')}}">
              <table class = "table">
                <thead>
                  <tr>
                    <th scope="col">Mark to delete</th>
                    <th scope="col">Type</th>
                    <th scope="col">Name</th>
                    </tr>
                  </thead>
                  <tbody  id = "notions_body">

                  </tbody>
              </table>
             <button type="submit" class="btn btn-primary">Delete</button>
          </form>
      </div>
    </div>

 <!----------------end of notions manager------->



  </div>


<!-----------------------End Tab Content --------------------->

<script
  src="https://code.jquery.com/jquery-3.5.1.js"
  integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
  crossorigin="anonymous"></script>

<script>
$(document).ready(function(){
    $('#qtype').on('change',function(){
        if ($("#questions-tab").hasClass("active")){
          // hide the multiple choice wrong answers when choosing a single entry exercise
            if ($(this).children("option:selected").val() =="SINGLE"){
                for (i =1;i<=3; i++)
                {
                    $('#wrong_answer'+i).addClass("d-none")
                    $('#wrong_answer'+i).removeClass("d-inline")
                    $("label[for='wrong_answer"+i+"']").addClass("d-none")
                    $("label[for='wrong_answer"+i+"']").removeClass("d-inline")
                }
            };
            // #unhide the multiple choice wrong answers when choosing the multiple choice exercises
            if ($(this).children("option:selected").val() =="MULTI"){

                for (i =1;i<=3; i++)
                {
                    $('#wrong_answer'+i).addClass("d-inline")
                    $('#wrong_answer'+i).removeClass("d-none")
                    $("label[for='wrong_answer"+i+"']").addClass("d-inline")
                }
            };

        }
    });
    // get exercises to delete by substring and show them as a list with checkbox to choose
    $('#q_delete_btn').click(function(){
        event.preventDefault();
        var search_key_string =  $("#q_delete").val();
        $.ajax({
          type : 'POST',
          url : "{{url_for('hub.find_questions_to_delete')}}",
          contentType: 'application/json;charset=UTF-8',
          data : JSON.stringify(search_key_string),
          success: function(response) {
                $('#form_delete_body').empty()
                $("#delete-q1").addClass("d-none")
                $("#delete-q1").removeClass("d-block")
                $("#delete-selection").removeClass("d-none")
                $("#delete-selection").addClass("d-block")
                var newRow=""
                $.each(response,function(i,item){
                  newRow +="<tr><td><input type='checkbox'class='form-check-input' value='"+item[0]+"' name='"+item[0]+"'</td>"+
                     "<td>"+item[0]+"</td>"+
                     "<td>"+item[1]+"</td>"+
                     "<td>"+item[2]+"</td>"+
                     "<td>"+item[3]+"</td>"+
                     "<td>"+item[4]+"</td>"+
                     "<td>"+item[5]+"</td></tr>"
                });
                $("#form_delete_body").append(newRow)
                }
        });

    });

    //show the data selected for deleteion and hide the search form
    $('#delete_btn').click(function(){
      if ($('#delete-question').hasClass("show")==false)
      {
          $('#delete-selection').addClass('d-none')
          $('#delete-selection').removeClass('d-block')
          $('#delete-q1').addClass('d-block')
          $('#delete-q1').removeClass('d-none')
      }

    });

    //update exam creation form with the exercises from DB to choose from
    $('#e_create_show').click(function(){
      if ($(this).hasClass("collapsed") == false){
            if(document.getElementById("q_chosing_table")){
              $("#q_chosing_table").remove()
              if ($("#delete-exam").hasClass("show")==true){
                  $("#delete-exam").removeClass("show")
                  $("#e_delete_show").addClass("collapsed")
              }//end of if delete-exam
              };
            $.ajax({
              type : 'POST',
              url : "{{url_for('hub.get_questions_for_exam')}}",
              contentType: 'application/json;charset=UTF-8',
              success: function(response) {
                //create the header of the table
                var insertedHtml = '<tr id="q_chosing_table"><td ><label for="q_chooser"> Choose questions to be added</label></td><td>\
                                    <table class="table" id="q_chooser">\
                                      <thead>\
                                        <tr>\
                                          <th scope="col"></th>\
                                          <th scope="col">Title</th>\
                                          <th scope="col">Question Body</th>\
                                          <th scope="col">Type</th>\
                                          <th scope="col">Notion</th>\
                                          <th scope="col">Complexity</th>\
                                        </tr>\
                                      </thead>\
                                      <tbody>'

                //create the rows from the data recieved in the response
                $.each(response,function(i,item){
                  insertedHtml +="<tr><td><input type='checkbox'class='form-check-input' value='"+item[0]+"' name='q_ID_"+item[0]+"'</td>"+
                            "<td>"+item[1]+"</td>"+
                            "<td>"+item[2]+"</td>"+
                            "<td>"+item[3]+"</td>"+
                            "<td>"+item[4]+"</td>"+
                            "<td>"+item[5]+"</td></tr>"
                                        });
                //close the table the row of the outer table
                insertedHtml+='</tbody></table></td></tr>'
                insert_after = $("#form_create_exam_body").find("tr").eq(3)
                $(insertedHtml).insertAfter($(insert_after))
              }

          });
      }

      });

      $("#e_delete_show").click(function(){
        if ($("#e_delete_show").hasClass("collapsed") == true){
              $("#create-exam").removeClass("show")


        }//end of if has collapsed


      }); //end of e_delete_exam click



      $('#e_delete_btn').click(function(){
          event.preventDefault();
          var search_key_string =  $("#e_delete").val();
          $.ajax({
            type : 'POST',
            url : "{{url_for('hub.find_exams_to_delete')}}",
            contentType: 'application/json;charset=UTF-8',
            data : JSON.stringify(search_key_string),
            success: function(response) {
                  $('#form_delete_exam_body').empty()
                  $("#delete-exam").addClass("d-none")
                  $("#delete-exam1").removeClass("d-block")
                  $("#delete_exam_selection").removeClass("d-none")
                  $("#delete_exam_selection").addClass("d-block")
                  var newRow=""
                  $.each(response,function(i,item){
                    newRow +="<tr><td><input type='checkbox'class='form-check-input' value='"+item[0]+"' name='"+item[0]+"'</td>"+
                       "<td>"+item[0]+"</td>"+
                       "<td>"+item[1]+"</td>"+
                       "<td>"+item[2]+"</td>"+
                       "<td>"+item[3]+"</td>"+
                       "<td>"+item[4]+"</td>"+
                       "<td>"+item[5]+"</td></tr>"
                  });
                  $("#form_delete_exam_body").append(newRow)
                  }
          });

      });

      $('#e_delete_btn').click(function(){
          event.preventDefault();
          var search_key_string =  $("#e_delete").val();
          $.ajax({
            type : 'POST',
            url : "{{url_for('hub.find_exams_to_delete')}}",
            contentType: 'application/json;charset=UTF-8',
            data : JSON.stringify(search_key_string),
            success: function(response) {
                  $('#form_delete_exam_body').empty()
                  $("#delete-exam").addClass("d-none")
                  $("#delete-exam1").removeClass("d-block")
                  $("#delete_exam_selection").removeClass("d-none")
                  $("#delete_exam_selection").addClass("d-block")
                  var newRow=""
                  $.each(response,function(i,item){
                    newRow +="<tr><td><input type='checkbox'class='form-check-input' value='"+item[0]+"' name='"+item[0]+"'</td>"+
                       "<td>"+item[0]+"</td>"+
                       "<td>"+item[1]+"</td>"+
                       "<td>"+item[2]+"</td>"+
                       "<td>"+item[3]+"</td>"+
                       "<td>"+item[4]+"</td>"+
                       "<td>"+item[5]+"</td></tr>"
                  });
                  $("#form_delete_exam_body").append(newRow)
                  }
          });
          });

      //Notions Show
      $('#notion-tab').click(function(){
          event.preventDefault();
          $.ajax({
            type : 'POST',
            url : "{{url_for('hub.find_notions')}}",
            contentType: 'application/json;charset=UTF-8',
            success: function(response) {
                  reponse_data = response[0]
                  turn_index = response[1]
                  $('#notions_body').empty()
                  var newRow=""
                  $.each(response,function(i,item){
                    if(item[1]=='notion'){
                      newRow +="<tr><td><input type='checkbox'class='form-check-input' value='"+item[0]+"' name='n_"+item[0]+"'</td>"+
                         "<td>"+item[1]+"</td>"+
                         "<td>"+item[2]+"</td></tr>"}
                    else{
                      newRow +="<tr><td><input type='checkbox'class='form-check-input' value='"+item[0]+"' name='sn_"+item[0]+"'</td>"+
                         "<td>"+item[1]+"</td>"+
                         "<td>"+item[2]+"</td></tr>"}
                  });
                  $("#notions_body").append(newRow)
                  }
          });

      });
  }); //end of document



</script>
{% endblock %}
